<!DOCTYPE html>
<html>
<head>
  <title>Habit Detail</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <style>
    /* Your existing CSS styles ... */

    /* New animation styles ... */

    /* New background styles ... */

    body {
      background-color: #000330;
      background-image: linear-gradient(45deg, #000330, #000630, #000330);
      background-size: 200% 200%;
      animation: gradientChange 10s ease infinite;
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    /* New text color change animation */
    .animate-text-color {
      animation: text-color-change 0.5s infinite alternate;
    }
    @keyframes text-color-change {
      0% { color: #00ffcc; }
      100% { color: #ffa500; }
    }
    /* Change text color to white */
    .white-text {
      color: #fff;
    }
    /* Other existing styles ... */
  </style>
</head>
<body>

  <div class="container animate-fade">
    <div class="row mt-4 animate-slide">
      <div class="col-md-12 text-center">
        <a href="/" class="btn btn-secondary btn-sm"><i class="fas fa-arrow-left"></i> Go Back</a>
        <h1 class="display-4 animate-bounce animate-text-color"><span class="emoji">üìù</span> <%= habit.name %> <span class="emoji">üìù</span></h1>
        <h2 class="lead animate-color-change animate-text-color"><i class="far fa-clock"></i> Longest Streak: <%= habit.longestStreak %></h2>
        <h2 class="lead animate-color-change animate-text-color"><i class="far fa-calendar"></i> Total Days: <%= habit.totalDays %></h2>
        <h2 class="lead animate-color-change animate-text-color"><i class="fas fa-check-circle"></i> Total Done Days: <%= habit.totalDoneDays %></h2>
      </div>
    </div>

    <div class="row mt-4 animate-slide">
      <div class="col-md-12">
        <form action="/habits/<%= habit._id %>/update-status" method="post">
          <table class="table table-bordered table-striped">
            <thead>
              <tr class="white-text">
                <th>Date</th>
                <th>Status</th>
                <th>Timing</th>
              </tr>
            </thead>
            <tbody>
              <% const today = new Date(); %>
              <% for (let i = 0; i < 7; i++) { %>
                <% const day = new Date(today.getTime() - i * 24 * 60 * 60 * 1000); %>
                <% const habitDay = habit.history.find(entry => entry.date.toDateString() === day.toDateString()); %>
                <% const defaultStatus = habitDay ? habitDay.status : 'None'; %>
                <% const defaultTiming = habitDay ? habitDay.timing : ''; %>
                <tr class="white-text">
                  <td><%= day.toDateString() %></td>
                  <td>
                    <select name="statuses[]" class="form-control">
                      <option value="Done" <% if (defaultStatus === 'Done') { %>selected<% } %>>Done</option>
                      <option value="Not Done" <% if (defaultStatus === 'Not Done') { %>selected<% } %>>Not Done</option>
                      <option value="None" <% if (defaultStatus === 'None') { %>selected<% } %>>None</option>
                    </select>
                  </td>
                  <td>
                    <input type="text" name="timings[]" value="<%= defaultTiming %>" class="form-control">
                  </td>
                </tr>
              <% } %>
            </tbody>
          </table>
          <button type="submit" class="btn btn-primary"><i class="fas fa-sync"></i> Update Status</button>
        </form>
      </div>
    </div>

    <div class="row mt-4 animate-slide">
      <div class="col-md-12 text-center">
        <div id="chart" style="width: 100%; height: 400px;"></div>
      </div>
    </div>
  </div>

  <script>
    google.charts.load('current', { packages: ['corechart'] });
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
      const dataArray = [
        ['Date', 'Streak'],
        <% habit.history.forEach(entry => { %>
          [new Date('<%= entry.date %>'), <%= entry.streak %>],
        <% }); %>
      ];

      const data = google.visualization.arrayToDataTable(dataArray);

      const options = {
        title: 'Streak Progress',
        curveType: 'function',
        legend: { position: 'bottom' },
        hAxis: { format: 'MMM d' },
        chartArea: { width: '80%', height: '70%' },
      };

      const chart = new google.visualization.LineChart(document.getElementById('chart'));

      chart.draw(data, options);
    }
  </script>

</body>
</html>
